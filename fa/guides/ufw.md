---
title: "تنظیم فایروال سرور مجازی با UFW"
description: "راهنمای کاربردی برای تنظیم فایروال سرور مجازی شما با استفاده از UFW (Uncomplicated Firewall)"
---

# تنظیم فایروال سرور مجازی با UFW

UFW (Uncomplicated Firewall) یک ابزار خط فرمان ساده و کاربردی برای مدیریت فایروال در سیستم‌عامل‌های مبتنی بر Linux است. در این راهنما، شما را با گام‌های لازم برای نصب، پیکربندی و مدیریت UFW آشنا خواهیم کرد.

## نصب UFW

ابتدا باید UFW را روی سرور خود نصب کنید. این ابزار در بسیاری از توزیع‌های Linux وجود دارد. برای نصب UFW در Ubuntu یا Debian، دستور زیر را اجرا کنید:

```bash
sudo apt update
sudo apt install ufw
```

## فعال‌سازی UFW

پس از نصب، باید UFW را فعال کنید:

```bash
sudo ufw enable
```

::: tip نکته
اگر سیستم شما از IPv6 استفاده می‌کند، باید قوانین IPv6 را نیز تنظیم کنید. برای فعال کردن حمایت از IPv6 در UFW، فایل `/etc/default/ufw` را ویرایش کنید و مقدار `IPV6` را به `yes` تغییر دهید.
:::

::: warning توجه
این دستور ممکن است دسترسی شما به سرور را مسدود کند اگر قبلاً [قوانین دسترسی](#تنظیم-قوانین-دسترسی) SSH را تنظیم نکرده باشید. پیشنهاد می‌شود قبل از فعال‌سازی UFW، [قوانین دسترسی](#تنظیم-قوانین-دسترسی) مورد نیاز را تنظیم کنید.
:::

## تنظیم قوانین دسترسی

### 1. اجازه دسترسی به SSH (پورت 22)

برای اطمینان از اینکه می‌توانید به سرور خود از طریق SSH متصل شوید، دستور زیر را اجرا کنید:

```bash
sudo ufw allow ssh
```

یا به صورت مشخص‌تر:

```bash
sudo ufw allow 22/tcp
```

::: tip نکته
اگر پورت SSH شما تغییر کرده است (به عنوان مثال، پورت ۲۲۲۲)، باید از عدد پورت صحیح استفاده کنید.
:::

### 2. اجازه دسترسی به خدمات دیگر

برای اجازه دادن به دسترسی خدمات دیگر مثل HTTP و HTTPS، دستورات زیر را استفاده کنید:

- اجازه دادن به HTTP:
  ```bash
  sudo ufw allow http
  ```
  یا:
  ```bash
  sudo ufw allow 80/tcp
  ```

- اجازه دادن به HTTPS:
  ```bash
  sudo ufw allow https
  ```
  یا:
  ```bash
  sudo ufw allow 443/tcp
  ```

### 3. مسدود کردن یک پورت خاص

برای مسدود کردن یک پورت خاص، مثلاً پورت ۲۵ (SMTP)، دستور زیر را اجرا کنید:

```bash
sudo ufw deny 25/tcp
```

### 4. حذف قوانین

گاهی اوقات ممکن است نیاز داشته باشید قوانینی را که به اشتباه اضافه کرده‌اید، حذف کنید. حذف قوانین در UFW ساده است و می‌توان آن را با استفاده از یکی از روش‌های زیر انجام داد:

#### **روش 1: حذف قانون با استفاده از شماره قانون**

ابتدا وضعیت UFW و لیست قوانین فعال خود را بررسی کنید تا شماره قانون مورد نظر را مشخص کنید:

```bash
sudo ufw status numbered
```

خروجی این دستور، قوانین فعال را به همراه شماره‌ی آنها نمایش می‌دهد. مثلاً خروجی ممکن است چنین باشد:

```
Status: active
  To                         Action      From
  --                         ------      ----
[1] 25                       ALLOW IN    Anywhere
[2] 80                       ALLOW IN    Anywhere
```

حالا شماره قانون مورد نظر (مثلاً `[1]`) را مشخص کرده و آن را حذف کنید:

```bash
sudo ufw delete 1
```

#### **روش 2: حذف قانون با استفاده از دستور مستقیم**

اگر مطمئن هستید که قانون خاصی (مانند اجازه دادن به پورت ۲۵) وجود دارد، می‌توانید آن را با دستور مستقیم حذف کنید:

```bash
sudo ufw delete allow 25
```

::: tip نکته
کلمه `delete` قبل از `allow` الزامی است. اگر فقط `ufw deny 25` را وارد کنید، قانون جدیدی برای مسدود کردن پورت ۲۵ ایجاد می‌شود، اما قانون قبلی حذف نمی‌شود.
:::

## مدیریت UFW

### 1. غیرفعال کردن UFW

برای غیرفعال کردن UFW، دستور زیر را اجرا کنید:

```bash
sudo ufw disable
```

::: tip نکته
غیرفعال کردن UFW تمام قوانین فعلی را از بین می‌برد تا زمانی که دوباره فعال کنید.
:::

### 2. بارگذاری مجدد UFW

برای اعمال تغییرات جدید در قوانین، دستور زیر را اجرا کنید:

```bash
sudo ufw reload
```

### 3. مشاهده وضعیت UFW

برای بررسی قوانین فعال UFW، دستور زیر را اجرا کنید:

```bash
sudo ufw status verbose
```

خروجی این دستور، لیستی از قوانین فعال و وضعیت فایروال را نمایش می‌دهد.

## تنظیمات پیشرفته UFW

### 1. تنظیم قوانین برای یک IP خاص

می‌توانید اجازه دسترسی به یک پورت را فقط به یک IP خاص بدهید. برای مثال، برای مجاز کردن دسترسی به SSH تنها از یک IP خاص، دستور زیر را اجرا کنید:

```bash
sudo ufw allow from 192.168.1.100 to any port 22
```

### 2. مسدود کردن دسترسی یک IP خاص

برای مسدود کردن دسترسی یک IP خاص، دستور زیر را اجرا کنید:

```bash
sudo ufw deny from 203.0.113.4
```
